(function(a){if(typeof define==="function"&&define.amd){define(["d3","JSRootPainter","THREE_ALL"],a)}else{if(typeof JSROOT=="undefined"){throw new Error("JSROOT is not defined","JSRoot3DPainter.js")}if(typeof d3!="object"){throw new Error("This extension requires d3.v3.js","JSRoot3DPainter.js")}if(typeof JSROOT.Painter!="object"){throw new Error("JSROOT.Painter is not defined","JSRoot3DPainter.js")}if(typeof THREE=="undefined"){throw new Error("THREE is not defined","JSRoot3DPainter.js")}a(d3,JSROOT)}}(function(b,a){a.Painter.TestWebGL=function(){if(a.gStyle.NoWebGL){return false}if("_Detect_WebGL" in this){return this._Detect_WebGL}try{var c=document.createElement("canvas");this._Detect_WebGL=!!(window.WebGLRenderingContext&&(c.getContext("webgl")||c.getContext("experimental-webgl")))}catch(d){return false}return this._Detect_WebGL};a.Painter.add3DInteraction=function(){var m=this;var f,d,e=0,i=false;var l=null;var q={tt:null,cont:null,pos:function(t){if(this.tt===null){return}var s=a.browser.isIE?(event.clientY+document.documentElement.scrollTop):t.pageY;var r=a.browser.isIE?(event.clientX+document.documentElement.scrollLeft):t.pageX;this.tt.style.top=(s+15)+"px";this.tt.style.left=(r+3)+"px"},show:function(s){if(!a.gStyle.Tooltip){return}if(this.tt===null){this.tt=document.createElement("div");var u=document.createElement("div");u.setAttribute("class","tt3d_border");this.cont=document.createElement("div");this.cont.setAttribute("class","tt3d_cont");var r=document.createElement("div");r.setAttribute("class","tt3d_border");this.tt.appendChild(u);this.tt.appendChild(this.cont);this.tt.appendChild(r);document.body.appendChild(this.tt);this.tt.style.opacity=1;this.tt.style.filter="alpha(opacity=1)";this.tt.style.position="absolute";this.tt.style.display="block"}this.cont.innerHTML=s;this.tt.style.width="auto";if(a.browser.isIE){this.tt.style.width=tt.offsetWidth}},hide:function(){if(this.tt!==null){document.body.removeChild(this.tt)}this.tt=null}};var k=new THREE.Raycaster();var h=m.first_render_tm<2000;function p(r){if(!a.gStyle.Tooltip){return q.hide()}k.setFromCamera(r,m.camera);var u=k.intersectObjects(m.scene.children,true);if(u.length>0){var t=null;for(var s=0;s<u.length;++s){if(("name" in u[s].object)&&(u[s].object.name.length>0)){t=u[s].object;break}}if((t!==null)&&(l!==t)){if(l&&h&&("emissive" in l.material)){l.material.emissive.setHex(l.currentHex)}l=t;if(h&&("emissive" in l.material)){l.currentHex=l.material.emissive.getHex();l.material.emissive.setHex(6250335);m.Render3D(0)}q.show(l.name,200)}}else{if(l&&h&&("emissive" in l.material)){l.material.emissive.setHex(l.currentHex);m.Render3D(0)}l=null;q.hide()}}function o(r){if("changedTouches" in r){return r.changedTouches}if("touches" in r){return r.touches}return[r]}function c(s){q.hide();s.preventDefault();var r=o(s);if(r.length==2){e=Math.sqrt(Math.pow(r[0].pageX-r[1].pageX,2)+Math.pow(r[0].pageY-r[1].pageY,2))}else{f=r[0].pageX;d=r[0].pageY}i=true}m.renderer.domElement.addEventListener("touchstart",c);m.renderer.domElement.addEventListener("mousedown",c);function j(v){var u=o(v);if(i){if(u.length==2){var z=Math.sqrt(Math.pow(u[0].pageX-u[1].pageX,2)+Math.pow(u[0].pageY-u[1].pageY,2));var A=(z-e)/(z+e);e=z;if(A===1){return}m.camera.position.x+=A*m.size3d*10;m.camera.position.y+=A*m.size3d*10;m.camera.position.z-=A*m.size3d*10}else{var t=u[0].pageX-f;var s=u[0].pageY-d;var r=m.camera.position.length();var w=r>m.size3d?0.001*r/m.size3d:0.01;m.toplevel.rotation.z+=t*w;m.toplevel.rotation.x+=s*w;m.toplevel.rotation.y-=s*w;f=u[0].pageX;d=u[0].pageY}m.Render3D(0)}else{if(u.length==1){var y=("offsetX" in u[0])?u[0].offsetX:u[0].layerX;var x=("offsetY" in u[0])?u[0].offsetY:u[0].layerY;mouse={x:(y/m.renderer.domElement.width)*2-1,y:-(x/m.renderer.domElement.height)*2+1};p(mouse);q.pos(u[0])}else{q.hide()}}v.stopPropagation();v.preventDefault()}m.renderer.domElement.addEventListener("touchmove",j);m.renderer.domElement.addEventListener("mousemove",j);function g(r){i=false;q.hide();e=0}m.renderer.domElement.addEventListener("touchend",g);m.renderer.domElement.addEventListener("touchcancel",g);m.renderer.domElement.addEventListener("mouseup",g);function n(r){r.preventDefault();r.stopPropagation();var s=0;if(r.wheelDelta){s=r.wheelDelta/400}else{if(r.detail){s=-r.detail/30}}m.camera.position.x-=s*m.size3d;m.camera.position.y-=s*m.size3d;m.camera.position.z+=s*m.size3d;m.Render3D(0)}m.renderer.domElement.addEventListener("mousewheel",n,false);m.renderer.domElement.addEventListener("MozMousePixelScroll",n,false);m.renderer.domElement.addEventListener("mouseleave",function(){q.hide()});m.renderer.domElement.addEventListener("contextmenu",function(r){r.preventDefault();q.hide();m.ShowContextMenu("hist",r)})};a.Painter.HPainter_Create3DScene=function(c){if((c!=null)&&(c<0)){this.clear_3d_canvas();delete this.size3d;delete this.scene;delete this.toplevel;delete this.camera;delete this.renderer;return}if("toplevel" in this){var g=new THREE.Object3D();g.rotation.x=this.toplevel.rotation.x;g.rotation.y=this.toplevel.rotation.y;this.scene.remove(this.toplevel);this.scene.add(g);this.toplevel=g;return}var e=this.size_for_3d();this.size3d=100;this.scene=new THREE.Scene();this.toplevel=new THREE.Object3D();this.scene.add(this.toplevel);this.scene_width=e.width;this.scene_height=e.height;this.camera=new THREE.PerspectiveCamera(45,this.scene_width/this.scene_height,1,40*this.size3d);var d=new THREE.PointLight(13619151);this.camera.add(d);d.position.set(this.size3d/10,this.size3d/10,this.size3d/10);this.camera.position.set(-3*this.size3d,-3*this.size3d,3*this.size3d);this.camera.up=new THREE.Vector3(0,0,1);this.camera.lookAt(new THREE.Vector3(0,0,this.size3d));this.scene.add(this.camera);var f=a.Painter.TestWebGL();this.renderer=f?new THREE.WebGLRenderer({antialias:true,alpha:true}):new THREE.CanvasRenderer({antialias:true,alpha:true});this.renderer.setSize(this.scene_width,this.scene_height);this.add_3d_canvas(this.renderer.domElement);this["DrawXYZ"]=a.Painter.HPainter_DrawXYZ;this["Render3D"]=a.Painter.Render3D;this["Resize3D"]=a.Painter.Resize3D;this.first_render_tm=0};a.Painter.HPainter_DrawXYZ=function(){var B=-this.size3d,j=this.size3d,A=-this.size3d,g=this.size3d,y=0,e=2*this.size3d,K=Math.round(this.size3d*0.07),t=(this.size3d!==0);if(this.size3d===0){B=this.xmin;j=this.xmax;A=this.ymin;g=this.ymax;y=this.zmin;e=this.zmax;K=(e-y)*0.05}if(this.options.Logx){var O=this.xmax<=0?1:this.xmax;var n=(this.xmin<=0)?0.000001*O:this.xmin;this.tx=b.scale.log().domain([n,O]).range([B,j])}else{this.tx=b.scale.linear().domain([this.xmin,this.xmax]).range([B,j])}if(this.options.Logy){var l=this.ymax<=0?1:this.ymax;var I=(this.ymin<=0)?0.000001*l:this.ymin;this.ty=b.scale.log().domain([I,l]).range([A,g])}else{this.ty=b.scale.linear().domain([this.ymin,this.ymax]).range([A,g])}if(this.options.Logz){var D=this.zmax<=0?1:this.zmax;var f=(this.zmin<=0)?0.000001*D:this.zmin;this.tz=b.scale.log().domain([f,D]).range([y,e])}else{this.tz=b.scale.linear().domain([this.zmin,this.zmax]).range([y,e])}var u=new THREE.MeshBasicMaterial({color:0});var q=new THREE.LineBasicMaterial({color:0});var L=K*0.5,E,d;var s=this.tx.ticks(8),P=this.tx.ticks(50);var v=new THREE.Geometry();v.vertices.push(new THREE.Vector3(0,0,0));v.vertices.push(new THREE.Vector3(0,-1,-1));for(var S=0;S<P.length;++S){var H=this.tx(P[S]);var C=s.indexOf(P[S]);var x=((C>=0)?L:L*0.6)*Math.sin(Math.PI/4);if(C>=0){var z=(C===s.length-1)?"x":P[S];var w=new THREE.TextGeometry(z,{size:K,height:0,curveSegments:10});w.computeBoundingBox();var k=0.5*(w.boundingBox.max.x-w.boundingBox.min.x);if(t){E=new THREE.Mesh(w,u);E.position.set(H+k,g+x+K,y-x-K);E.rotation.x=Math.PI*3/4;E.rotation.y=Math.PI;E.name="X axis";this.toplevel.add(E)}E=new THREE.Mesh(w,u);E.position.set(H-k,A-x-K,y-x-K);E.rotation.x=Math.PI/4;E.name="X axis";this.toplevel.add(E)}if(t){d=new THREE.Line(v,q);d.position.set(H,g,y);d.scale.set(1,x,x);d.rotation.z=Math.PI;d.name="X axis: "+P[S];this.toplevel.add(d)}d=new THREE.Line(v,q);d.position.set(H,A,y);d.scale.set(1,x,x);d.name="X axis: "+P[S];this.toplevel.add(d)}var r=this.ty.ticks(8),N=this.ty.ticks(50);v=new THREE.Geometry();v.vertices.push(new THREE.Vector3(0,0,0));v.vertices.push(new THREE.Vector3(-1,0,-1));for(var S=0;S<N.length;++S){var G=this.ty(N[S]);var C=r.indexOf(N[S]);var x=((C>=0)?L:L*0.6)*Math.sin(Math.PI/4);if(C>=0){var z=(C===r.length-1)?"y":N[S];var w=new THREE.TextGeometry(z,{size:K,height:0,curveSegments:10});w.computeBoundingBox();var k=0.5*(w.boundingBox.max.x-w.boundingBox.min.x);if(t){E=new THREE.Mesh(w,u);E.position.set(j+x+K,G+k,y-x-K);E.rotation.y=Math.PI/4;E.rotation.z=Math.PI/2;E.name="Y axis";this.toplevel.add(E)}E=new THREE.Mesh(w,u);E.position.set(B-x-K,G+k,y-x-K);E.rotation.y=-Math.PI/4;E.rotation.z=-Math.PI/2;E.name="Y axis";this.toplevel.add(E)}if(t){d=new THREE.Line(v,q);d.position.set(j,G,y);d.scale.set(x,1,x);d.rotation.z=Math.PI;d.name="Y axis "+N[S];this.toplevel.add(d)}d=new THREE.Line(v,q);d.position.set(B,G,y);d.scale.set(x,1,x);d.name="Y axis "+N[S];this.toplevel.add(d)}var p=this.tz.ticks(8),M=this.tz.ticks(50);v=new THREE.Geometry();v.vertices.push(new THREE.Vector3(0,0,0));v.vertices.push(new THREE.Vector3(-1,1,0));for(var S=0;S<M.length;++S){var F=this.tz(M[S]);var R=p.indexOf(M[S])>=0;var x=(R?L:L*0.6)*Math.sin(Math.PI/4);if(R){var w=new THREE.TextGeometry(M[S],{size:K,height:0,curveSegments:10});w.computeBoundingBox();var Q=0.8*(w.boundingBox.max.x-w.boundingBox.min.x)+0.7*K;var J=F-0.4*K;if(t){E=new THREE.Mesh(w,u);E.position.set(j+Q,g+Q,J);E.rotation.x=0.5*Math.PI;E.rotation.y=-0.75*Math.PI;E.name="Z axis";this.toplevel.add(E);E=new THREE.Mesh(w,u);E.position.set(j+Q,A-Q,J);E.rotation.x=0.5*Math.PI;E.rotation.y=0.75*Math.PI;E.name="Z axis";this.toplevel.add(E);E=new THREE.Mesh(w,u);E.position.set(B-Q,A-Q,J);E.rotation.x=0.5*Math.PI;E.rotation.y=0.25*Math.PI;E.name="Z axis";this.toplevel.add(E)}E=new THREE.Mesh(w,u);E.position.set(B-Q,g+Q,J);E.rotation.x=0.5*Math.PI;E.rotation.y=-0.25*Math.PI;E.name="Z axis";this.toplevel.add(E)}if(t){d=new THREE.Line(v,q);d.position.set(j,g,F);d.scale.set(x,x,1);d.rotation.z=-Math.PI/2;d.name="Z axis "+M[S];this.toplevel.add(d);d=new THREE.Line(v,q);d.position.set(j,A,F);d.scale.set(x,x,1);d.rotation.z=Math.PI;d.name="Z axis "+M[S];this.toplevel.add(d);d=new THREE.Line(v,q);d.position.set(B,A,F);d.scale.set(x,x,1);d.rotation.z=Math.PI/2;d.name="Z axis "+M[S];this.toplevel.add(d)}d=new THREE.Line(v,q);d.position.set(B,g,F);d.scale.set(x,x,1);d.name="Z axis "+M[S];this.toplevel.add(d)}if(this.size3d===0){return}var c=new THREE.MeshBasicMaterial({color:0,wireframe:true,wireframeLinewidth:0.5,side:THREE.DoubleSide});var h=new THREE.Mesh(new THREE.BoxGeometry(this.size3d*2,this.size3d*2,this.size3d*2),c);var o=new THREE.BoxHelper(h);o.material.color.set(0);var m=new THREE.Object3D();m.add(o);m.position.z=this.size3d;this.toplevel.add(m)};a.Painter.TH2Painter_Draw3DBins=function(){var k=b.rgb(a.Painter.root_colors[this.histo.fFillColor]);var c=this.CreateDrawBins(100,100,2,(a.gStyle.Tooltip?1:0));var g=new THREE.Color(14540253);g.setRGB(k.r/255,k.g/255,k.b/255);var j=new THREE.MeshLambertMaterial({color:g.getHex()});var l=new THREE.BoxGeometry(2*this.size3d/this.nbinsx,2*this.size3d/this.nbinsy,1);for(var h=0;h<c.length;++h){var f=c[h];var d=this.tz(f.z);var m=new THREE.Mesh(l,j.clone());m.position.set(this.tx(f.x),this.ty(f.y),d/2);m.scale.set(1,1,d);if(a.gStyle.Tooltip&&("tip" in f)){m.name=f.tip.replace(/(?:\r\n|\r|\n)/g,"<br/>")}this.toplevel.add(m);var e=new THREE.BoxHelper(m);e.material.color.set(0);e.material.linewidth=1;this.toplevel.add(e)}delete c;c=null};a.Painter.Render3D=function(e){if(e===undefined){e=5}if(e<=0){if("render_tmout" in this){clearTimeout(this["render_tmout"])}var d=new Date();this.renderer.render(this.scene,this.camera);var c=new Date();delete this["render_tmout"];if(this.first_render_tm===0){this.first_render_tm=c.getTime()-d.getTime();console.log("First render tm = "+this.first_render_tm);this["Add3DInteraction"]=a.Painter.add3DInteraction;this.Add3DInteraction()}return}if("render_tmout" in this){return}this["render_tmout"]=setTimeout(this.Render3D.bind(this,0),e)};a.Painter.Resize3D=function(d){var c=this.size_for_3d();if((this.scene_width===c.width)&&(this.scene_height===c.height)){return}if((c.width<10)||(c.height<10)){return}this.scene_width=c.width;this.scene_height=c.height;this.camera.aspect=this.scene_width/this.scene_height;this.camera.updateProjectionMatrix();this.renderer.setSize(this.scene_width,this.scene_height);this.Render3D()};a.Painter.TH2Painter_Draw3D=function(c){this.Create3DScene();this.zmin=this.gminbin;this.zmax=Math.ceil(this.gmaxbin/100)*105;this.DrawXYZ();this.Draw3DBins();this.DrawTitle();this.Render3D();a.CallBack(c)};a.TH3Painter=function(c){a.THistPainter.call(this,c);this["Create3DScene"]=a.Painter.HPainter_Create3DScene};a.TH3Painter.prototype=Object.create(a.THistPainter.prototype);a.TH3Painter.prototype.ScanContent=function(){this.nbinsx=this.histo.fXaxis["fNbins"];this.nbinsy=this.histo.fYaxis["fNbins"];this.nbinsz=this.histo.fZaxis["fNbins"];this.xmin=this.histo.fXaxis["fXmin"];this.xmax=this.histo.fXaxis["fXmax"];this.ymin=this.histo.fYaxis["fXmin"];this.ymax=this.histo.fYaxis["fXmax"];this.zmin=this.histo.fZaxis["fXmin"];this.zmax=this.histo.fZaxis["fXmax"];this.gminbin=this.gmaxbin=this.histo.getBinContent(1,1,1);for(var e=0;e<this.nbinsx;++e){for(var d=0;d<this.nbinsy;++d){for(var c=0;c<this.nbinsz;++c){var f=this.histo.getBinContent(e+1,d+1,c+1);if(f<this.gminbin){this.gminbin=f}else{if(f>this.gmaxbin){this.gmaxbin=f}}}}}this.draw_content=this.gmaxbin>0};a.TH3Painter.prototype.CountStat=function(){var g=0,k=0,p=0,d=0,j=0,o=0,c=0;var t={entries:0,integral:0,meanx:0,meany:0,meanz:0,rmsx:0,rmsy:0,rmsz:0};for(var m=0;m<this.nbinsx+2;++m){var i=this.xmin+(m-0.5)/this.nbinsx*(this.xmax-this.xmin);var f=(m===0)?0:(m===this.nbinsx+1?2:1);for(var s=0;s<this.nbinsy+2;++s){var n=this.ymin+(s-0.5)/this.nbinsy*(this.ymax-this.ymin);var q=(s===0)?0:(s===this.nbinsy+1?2:1);for(var h=0;h<this.nbinsz+2;++h){var r=this.zmin+(h-0.5)/this.nbinsz*(this.zmax-this.zmin);var l=(h===0)?0:(h===this.nbinsz+1?2:1);var e=this.histo.getBinContent(m,s,h);t.entries+=e;if((f==1)&&(q==1)&&(l==1)){g+=e;k+=i*e;p+=n*e;d+=r*e;j+=i*i*e;o+=n*n*e;c+=r*r*e}}}}if(this.histo.fTsumw>0){g=this.histo.fTsumw;k=this.histo.fTsumwx;j=this.histo.fTsumwx2;p=this.histo.fTsumwy;o=this.histo.fTsumwy2;d=this.histo.fTsumwz;c=this.histo.fTsumwz2}if(g>0){t.meanx=k/g;t.meany=p/g;t.meanz=d/g;t.rmsx=Math.sqrt(j/g-t.meanx*t.meanx);t.rmsy=Math.sqrt(o/g-t.meany*t.meany);t.rmsz=Math.sqrt(c/g-t.meanz*t.meanz)}t.integral=g;if(this.histo.fEntries>1){t.entries=this.histo.fEntries}return t};a.TH3Painter.prototype.FillStatistic=function(g,h,o){if(!this.histo){return false}var f=this.CountStat();var j=h%10;var l=Math.floor(h/10)%10;var i=Math.floor(h/100)%10;var m=Math.floor(h/1000)%10;var c=Math.floor(h/10000)%10;var d=Math.floor(h/100000)%10;var e=Math.floor(h/1000000)%10;if(j>0){g.AddLine(this.histo.fName)}if(l>0){g.AddLine("Entries = "+g.Format(f.entries,"entries"))}if(i>0){g.AddLine("Mean x = "+g.Format(f.meanx));g.AddLine("Mean y = "+g.Format(f.meany));g.AddLine("Mean z = "+g.Format(f.meanz))}if(m>0){g.AddLine("Std Dev x = "+g.Format(f.rmsx));g.AddLine("Std Dev y = "+g.Format(f.rmsy));g.AddLine("Std Dev z = "+g.Format(f.rmsz))}if(e>0){g.AddLine("Integral = "+g.Format(f.integral,"entries"))}var k=g.pavetext.fLines.arr.length;var n=k*a.gStyle.StatFontSize;if(n<=0||3==(a.gStyle.StatFont%10)){n=0.25*k*a.gStyle.StatH;g.pavetext.fY1NDC=0.93-n;g.pavetext.fY2NDC=0.93}return true};a.TH3Painter.prototype.CreateBins=function(){var h=[];var e=this.GetItemName();if((e==null)||(e=="")){e=this.histo.fName}if(e.length>0){e+="<br/>"}for(var g=0;g<this.nbinsx;++g){for(var d=0;d<this.nbinsy;++d){for(var c=0;c<this.nbinsz;++c){var l=this.histo.getBinContent(g+1,d+1,c+1);if(l<=this.gminbin){continue}var f={x:this.xmin+(g+0.5)/this.nbinsx*(this.xmax-this.xmin),y:this.ymin+(d+0.5)/this.nbinsy*(this.ymax-this.ymin),z:this.zmin+(c+0.5)/this.nbinsz*(this.zmax-this.zmin),n:l};if(a.gStyle.Tooltip){f.tip=e+"x="+a.FFormat(f.x,"6.4g")+" bin="+(g+1)+"<br/>y="+a.FFormat(f.y,"6.4g")+" bin="+(d+1)+"<br/>z="+a.FFormat(f.z,"6.4g")+" bin="+(c+1)+"<br/>entries="+a.FFormat(f.n,"7.0g")}h.push(f)}}}return h};a.TH3Painter.prototype.Draw3DBins=function(){if(!this.draw_content){return}var k=this.CreateBins();var h=b.rgb(a.Painter.root_colors[this.histo.fFillColor]);var e=new THREE.Color(14540253);e.setRGB(h.r/255,h.g/255,h.b/255);var g=null,j=null;if(this.options.Box==11){g=new THREE.MeshPhongMaterial({color:e.getHex(),specular:5197647});j=new THREE.SphereBufferGeometry(this.size3d/this.nbinsx);j.scale(1,this.nbinsx/this.nbinsy,this.nbinsx/this.nbinsz)}else{g=new THREE.MeshLambertMaterial({color:e.getHex()});j=new THREE.BoxGeometry(2*this.size3d/this.nbinsx,2*this.size3d/this.nbinsy,2*this.size3d/this.nbinsz)}var l,c;for(var f=0;f<k.length;++f){c=(this.options.Color>0)?1:k[f].n/this.gmaxbin;if(c<0.00001){continue}l=new THREE.Mesh(j,g.clone());l.position.set(this.tx(k[f].x),this.ty(k[f].y),this.tz(k[f].z));l.scale.set(c,c,c);if("tip" in k[f]){l.name=k[f].tip}this.toplevel.add(l);if(this.options.Box!=11){var d=new THREE.BoxHelper(l);d.material.color.set(0);d.material.linewidth=1;this.toplevel.add(d)}}};a.TH3Painter.prototype.Redraw=function(){this.Create3DScene();this.DrawXYZ();this.Draw3DBins();this.Render3D()};a.TH3Painter.prototype.CheckResize=function(c){var d=this.pad_painter();var e=true;if(d){e=d.CheckCanvasResize(c,a.browser.isFirefox?false:true)}if(e){this.Resize3D(c)}};a.Painter.drawHistogram3D=function(f,c,e){a.extend(this,new a.TH3Painter(c));this.SetDivId(f,4);this.options=this.DecodeOptions(e);this.CheckPadOptions();this.ScanContent();this.Redraw();this.DrawTitle();if(a.gStyle.AutoStat&&this.create_canvas){var d=this.CreateStat();if(d){a.draw(this.divid,d,"")}}return this.DrawingReady()};a.Painter.drawPolyMarker3D=function(l,c,d){this.SetDivId(l);var i=this.main_painter();if((i==null)||!("renderer" in i)){return this.DrawingReady()}var g=c.fP.length;var f=3;if((a.gStyle.OptimizeDraw>0)&&(g>1000*3)){f=Math.floor(g/1000/3)*3;if(f<=6){f=6}}var k=b.rgb(a.Painter.root_colors[c.fMarkerColor]);var h=new THREE.Color(14540253);h.setRGB(k.r/255,k.g/255,k.b/255);var j=new THREE.MeshPhongMaterial({color:h.getHex(),specular:5197647});var m=new THREE.BoxGeometry(1,1,1);for(var e=0;e<g;e+=f){var o=new THREE.Mesh(m,j.clone());o.position.set(i.tx(c.fP[e]),i.ty(c.fP[e+1]),i.tz(c.fP[e+2]));o.name=c.fName;i.toplevel.add(o)}i.Render3D();return this.DrawingReady()};return a.Painter}));